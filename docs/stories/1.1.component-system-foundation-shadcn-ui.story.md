# Story 1.1: Component System Foundation with shadcn/ui

## Status

Done

## Story

**As a** frontend developer,
**I want** a comprehensive design system with shadcn/ui components,
**so that** I can build consistent, accessible UI components efficiently.

## Acceptance Criteria

1. **1.1.1:** Install and configure shadcn/ui with Tailwind CSS integration
2. **1.1.2:** Set up custom theme configuration with BrickOps brand colors and typography
3. **1.1.3:** Configure responsive breakpoint system for mobile-first design
4. **1.1.4:** Install core shadcn/ui components (Button, Input, Card, Dialog, Table, etc.)
5. **1.1.5:** Create custom component library structure with proper TypeScript definitions
6. **1.1.6:** Set up accessibility utilities and WCAG AA compliance tools
7. **1.1.7:** Implement dark/light mode support foundation
8. **1.1.8:** Create reusable layout components (Header, Navigation, Container)

## Tasks / Subtasks

- [x] Task 1 (AC: 1.1.1, 1.1.4) — Scaffold shadcn/ui tooling and align generator output with our component architecture. [Source: architecture/tech-stack.md#tech-stack; architecture/frontend-architecture.md#component-architecture]
  - [x] Add the shadcn/ui CLI as a dev dependency and configure it to write components into `src/components/ui`. [Source: architecture/frontend-architecture.md#component-architecture]
  - [x] **CRITICAL**: Configure shadcn/ui to use `pnpm dlx shadcn@latest add [component]` for all component installations. Do NOT install Radix UI components directly.
  - [x] Ensure Tailwind configuration imports shadcn presets/plugins without breaking existing utility classes. [Source: architecture/tech-stack.md#tech-stack]
  - [x] Verify base utilities (e.g., `cn` helper) live under `src/lib` for reuse across generated components. [Source: architecture/frontend-architecture.md#component-template]
- [x] Task 2 (AC: 1.1.2, 1.1.3, 1.1.7) — Establish design tokens, responsive scales, and theme toggling aligned with mobile-first requirements. [Source: architecture/frontend-architecture.md#design-tokens; architecture/security-and-performance.md#theme-and-responsive-design]
  - [x] Extend `tailwind.config.ts` with BrickOps brand palette, typography scale, and spacing tokens surfaced as CSS variables. [Source: architecture/frontend-architecture.md#design-tokens]
  - [x] Define Tailwind breakpoints and container widths optimized for mobile-first layouts. [Source: architecture/security-and-performance.md#responsive-breakpoint-strategy]
  - [x] Implement dark/light mode toggling (e.g., via CSS variables and `prefers-color-scheme`) and document usage expectations. [Source: architecture/security-and-performance.md#dark-light-mode-support]
- [x] Task 3 (AC: 1.1.4, 1.1.5) — Generate core UI primitives with strict TypeScript typings and exports. [Source: architecture/frontend-architecture.md#component-template]
  - [x] Install shadcn/ui primitives using CLI: `pnpm dlx shadcn@latest add button input card dialog table sheet tabs` and refactor to use shared prop/types patterns. [Source: architecture/frontend-architecture.md#component-template]
  - [x] **MANDATORY**: Use only the shadcn/ui CLI for component installation. Do NOT install Radix UI components directly.
  - [x] Provide barrel exports for UI primitives with proper TypeScript definitions. [Source: architecture/frontend-architecture.md#component-architecture]
  - [x] Add unit tests or snapshot coverage for representative components per testing strategy. [Source: architecture/testing-strategy.md#frontend-tests]
- [x] Task 4 (AC: 1.1.6) — Integrate accessibility utilities and automated checks. [Source: architecture/tech-stack.md#tech-stack]
  - [x] Wire aria attribute helpers, focus-visible styles, and keyboard navigation defaults into shared UI primitives. [Source: architecture/frontend-architecture.md#component-template]
  - [x] Enable lint/test automation (e.g., `eslint-plugin-jsx-a11y` rules, Playwright axe checks) for accessibility regressions. [Source: architecture/testing-strategy.md#testing-pyramid]
- [x] Task 5 (AC: 1.1.8) — Build layout scaffolding components for application shell. [Source: architecture/frontend-architecture.md#component-architecture]
  - [x] Implement Header, Navigation, and Container components that respect responsive and role-based layout requirements. [Source: architecture/frontend-architecture.md#component-architecture]
  - [x] Provide composition examples demonstrating dashboard, catalog, and order views. [Source: architecture/core-workflows.md#order-processing-and-inventory-sync]
  - [x] Add visual regression or interaction tests covering layout breakpoints and navigation behavior. [Source: architecture/testing-strategy.md#frontend-tests]

## Dev Notes

### Previous Story Insights

- The scaffold already ships with Tailwind CSS 3.4.0+ and Next.js App Router; ensure design system changes preserve existing utilities and scripts. [Source: architecture/tech-stack.md#tech-stack]
- Component directories follow the domain-centric structure defined in the frontend architecture, so shadcn output should integrate within `src/components`. [Source: architecture/frontend-architecture.md#component-architecture]

### Data Models

- No specific guidance found in architecture docs.

### API Specifications

- No specific guidance found in architecture docs.

### Component Specifications

- UI primitives should follow the forwarded ref pattern with `cn` utility composition to stay consistent with the shared template. [Source: architecture/frontend-architecture.md#component-template]
- Layout, domain, and UI folders organize components by reuse level; keep primitives in `ui/`, layout shells in `layout/`, and domain composites elsewhere. [Source: architecture/frontend-architecture.md#component-architecture]

### Component Installation Guidelines

- **CRITICAL**: All UI components MUST be installed using the shadcn/ui CLI: `pnpm dlx shadcn@latest add [component-name]`
- **FORBIDDEN**: Do NOT install Radix UI components directly via npm/pnpm
- Available components for installation include: Accordion, Alert, Alert Dialog, Aspect Ratio, Avatar, Badge, Breadcrumb, Button, Calendar, Card, Carousel, Chart, Checkbox, Collapsible, Combobox, Command, Context Menu, Data Table, Date Picker, Dialog, Drawer, Dropdown Menu, Form (React Hook Form), Hover Card, Input, Input OTP, Label, Menubar, Navigation Menu, Pagination, Popover, Progress, Radio Group, Resizable, Scroll-area, Select, Separator, Sheet, Sidebar, Skeleton, Slider, Sonner, Switch, Table, Tabs, Textarea, Toast, Toggle, Toggle Group, Tooltip, Typography
- Components are automatically installed to `src/components/ui/` and can be imported as `import { Button } from "@/components/ui/button"`
- All shadcn/ui components come pre-configured with our design tokens and accessibility features

### Design System Specifications

- **Brand Colors**: Professional blue palette with primary colors (#3b82f6, #2563eb, #1d4ed8) and neutral grays. Full color system defined in CSS custom properties for light/dark themes. [Source: architecture/frontend-architecture.md#brickops-brand-colors]
- **Typography**: Inter font family with scale from 12px to 36px, optimized for readability. Line heights: tight (1.25), normal (1.5), relaxed (1.625). [Source: architecture/frontend-architecture.md#typography-scale]
- **Responsive Breakpoints**: Mobile-first approach with breakpoints at 640px, 768px, 1024px, 1280px, 1536px. Touch targets minimum 44px. [Source: architecture/security-and-performance.md#responsive-breakpoint-strategy]
- **Theme Support**: CSS variables with `prefers-color-scheme` detection, localStorage persistence, smooth transitions between light/dark modes. [Source: architecture/security-and-performance.md#dark-light-mode-support]

### File Locations

- UI primitives belong under `src/components/ui`, while layout scaffolding lives in `src/components/layout`. [Source: architecture/frontend-architecture.md#component-architecture]
- The overall repo structure defined in the unified project structure must remain intact when introducing documentation config and generators. [Source: architecture/unified-project-structure.md#unified-project-structure]

### Testing Requirements

- Component unit tests reside in `__tests__/components` with React Testing Library; include coverage for interactive states and accessibility. [Source: architecture/testing-strategy.md#frontend-tests]
- Maintain testing pyramid balance by limiting snapshot reliance and using Playwright for key layout regressions. [Source: architecture/testing-strategy.md#testing-pyramid]

### Technical Constraints

- Keep dependencies compatible with Node.js 20.11.0 LTS, Next.js 14.1.0+, Tailwind CSS 3.4.0+, and shadcn/ui per the tech stack. [Source: architecture/tech-stack.md#tech-stack]
- Preserve mobile-first performance focus when designing responsive breakpoints and component defaults. [Source: architecture/security-and-performance.md#performance-optimization]

### Project Structure Notes

- Ensure any design documentation tooling or reference pages live within the root without disrupting the prescribed directories. [Source: architecture/unified-project-structure.md#unified-project-structure]

## Testing

- Author component unit tests under `__tests__/components` with Jest + React Testing Library following the provided examples. [Source: architecture/testing-strategy.md#frontend-tests]
- Add Playwright coverage for layout primitives within the existing e2e suite to validate responsive behavior. [Source: architecture/testing-strategy.md#e2e-tests]

## Change Log

| Date       | Version | Description                                                               | Author                |
| ---------- | ------- | ------------------------------------------------------------------------- | --------------------- |
| 2025-09-20 | 0.1     | Initial story draft created                                               | Bob (Scrum Master)    |
| 2025-09-20 | 0.2     | Removed Storybook requirement - simplified component development approach | Sarah (Product Owner) |
| 2025-09-20 | 0.3     | Hardened AppNavigation null guard and restored frontend regression suite  | James (Developer)     |

## Dev Agent Record

### Agent Model Used

- GPT-5 (Codex CLI)

### Debug Log References

- `pnpm test:frontend`

### Completion Notes List

- Configured shadcn tooling (`components.json`, dev dependency) with Tailwind theme tokens, BrickOps breakpoints, and reusable `cn` helper.
- Generated core primitives (button, input, card, dialog, sheet, table, tabs, theme toggle) with barrel exports and design system reference page under `src/app/design-system`.
- Added responsive layout scaffolding (`AppHeader`, `AppNavigation`, `PageContainer`) plus dashboard/catalog/orders shell examples and home page integration.
- Extended accessibility support via focus ring utility, `aria-current` navigation states, mobile sheet semantics, and Jest RTL coverage for navigation/theming.
- Hardened `AppNavigation` against null pathnames and updated Home page RTL test to mock routing so `pnpm test:frontend` passes again.

### File List

- components.json
- pnpm-workspace.yaml
- tailwind.config.ts
- src/app/globals.css
- src/app/layout.tsx
- src/app/page.tsx
- src/app/design-system/page.tsx
- src/app/design-system/examples/dashboard/page.tsx
- src/app/design-system/examples/catalog/page.tsx
- src/app/design-system/examples/orders/page.tsx
- src/components/providers/theme-provider.tsx
- src/components/ui/index.ts
- src/components/ui/button.tsx
- src/components/ui/card.tsx
- src/components/ui/dialog.tsx
- src/components/ui/input.tsx
- src/components/ui/sheet.tsx
- src/components/ui/table.tsx
- src/components/ui/tabs.tsx
- src/components/ui/theme-toggle.tsx
- src/components/layout/app-header.tsx
- src/components/layout/app-navigation.tsx
- src/components/layout/page-container.tsx
- src/components/layout/examples/dashboard-shell.tsx
- src/components/layout/examples/catalog-shell.tsx
- src/components/layout/examples/orders-shell.tsx
- **tests**/frontend/components/ui/button.test.tsx
- **tests**/frontend/components/ui/theme-toggle.test.tsx
- **tests**/frontend/components/layout/app-navigation.test.tsx
- **tests**/frontend/home-page.test.tsx
- docs/architecture/frontend-architecture.md

## QA Results

_Pending QA review_

### Review Date: 2025-09-20

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The Shadcn UI integration, theming tokens, and layout scaffolding are well organized, but `AppNavigation` assumes `usePathname()` always returns a string. Rendering the Home page in Jest now crashes before assertions run, which breaks the existing regression safety net and exposes the navigation to runtime issues anywhere the hook is unavailable.

### Refactoring Performed

None – review focused on analysis and test execution.

### Compliance Check

- Coding Standards: ✓ Established tokens/components follow documented conventions.
- Project Structure: ✓ UI primitives and layout modules land in the expected directories.
- Testing Strategy: ✗ `pnpm test:frontend` fails because `AppNavigation` throws when `usePathname()` returns null in the Home page suite.
- All ACs Met: ✓ Functional criteria appear satisfied, pending the reliability fix above.

### Improvements Checklist

- [ ] Harden `AppNavigation` to handle a null pathname so Jest and any SSR boundary stay stable (`src/components/layout/app-navigation.tsx`).
- [ ] Update `__tests__/frontend/home-page.test.tsx` (or shared setup) to provide a pathname mock that exercises the new header without crashing.

### Security Review

No new security risks observed; dependencies rely on vetted Shadcn and Radix packages.

### Performance Considerations

No performance regressions detected. Components remain primarily presentational.

### Files Modified During Review

None.

### Gate Status

Gate: FAIL → docs/qa/gates/1.1-component-system-foundation-shadcn-ui.yml
Risk profile: docs/qa/assessments/1.1-risk-20250920.md (not generated)
NFR assessment: docs/qa/assessments/1.1-nfr-20250920.md (not generated)

### Recommended Status

[✗ Changes Required - See unchecked items above]

### Review Date: 2025-09-20

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Re-test confirms the navigation now tolerates a missing pathname and the frontend regression suite completes cleanly. Implementation matches the ACs with no lingering reliability risks.

### Refactoring Performed

None – verification only; development already supplied the guard and test updates.

### Compliance Check

- Coding Standards: ✓ Guard follows documented React patterns and shared utils.
- Project Structure: ✓ Navigation and tests remain in their prescribed locations.
- Testing Strategy: ✓ `pnpm test:frontend` passes, restoring RTL coverage for the home page.
- All ACs Met: ✓ Verified via implementation review and green regression.

### Improvements Checklist

- [x] Harden `AppNavigation` to handle a null pathname so Jest and any SSR boundary stay stable (`src/components/layout/app-navigation.tsx`).
- [x] Update `__tests__/frontend/home-page.test.tsx` (or shared setup) to provide a pathname mock that exercises the new header without crashing.

### Security Review

No new vectors introduced; change scope limited to routing guard and test mocks.

### Performance Considerations

Presentation-only update; no measurable perf impact.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/1.1-component-system-foundation-shadcn-ui.yml

### Recommended Status

[✓ Ready for Done]
